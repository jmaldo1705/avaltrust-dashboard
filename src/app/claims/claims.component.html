<div class="dashboard-layout">
  <!-- Sidebar Component -->
  <app-sidebar
    [isSidebarOpen]="isSidebarOpen"
    [isOpen]="isSidebarOpen"
    (navigate)="onSidebarNavigate($event)"
    (close)="onSidebarClose()"
    (sidebarClose)="closeSidebar()">
  </app-sidebar>

  <!-- Overlay para m√≥vil -->
  <div class="overlay" [class.active]="isSidebarOpen || isUserMenuOpen" (click)="closeSidebar(); closeUserMenu()"></div>

  <!-- Header Component -->
  <app-header
    [isSidebarOpen]="isSidebarOpen"
    [isUserMenuOpen]="isUserMenuOpen"
    (toggleSidebar)="toggleSidebar()"
    (toggleUserMenu)="toggleUserMenu()"
    (closeUserMenu)="closeUserMenu()"
    (navigate)="onHeaderNavigate($event)"
    (logout)="logout()">
  </app-header>

  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Header de la p√°gina -->
    <div class="content-header">
      <h2>Cargue de Siniestros</h2>
      <p class="welcome-message">
        Administre los registros de siniestros mediante formulario manual o carga masiva de archivos
      </p>
    </div>

    <!-- Resultado de la operaci√≥n -->
    <div class="result-container" *ngIf="uploadResult">
      <div class="result-card" [ngClass]="uploadResult.success ? 'success' : 'error'">
        <div class="result-icon">
          {{ uploadResult.success ? '‚úÖ' : '‚ùå' }}
        </div>
        <div class="result-content">
          <h4>{{ uploadResult.success ? 'Operaci√≥n Exitosa' : 'Error en la Operaci√≥n' }}</h4>
          <p>{{ uploadResult.message }}</p>
          <div class="result-details" *ngIf="uploadResult.records">
            <span>Registros procesados: <strong>{{ uploadResult.records }}</strong></span>
          </div>
          <div class="error-list" *ngIf="uploadResult.errors && uploadResult.errors.length > 0">
            <h5>Errores encontrados:</h5>
            <ul>
              <li *ngFor="let error of uploadResult.errors">{{ error }}</li>
            </ul>
          </div>
        </div>
        <button
          type="button"
          class="result-close"
          (click)="uploadResult = null">
          ‚úï
        </button>
      </div>
    </div>

    <!-- Navegaci√≥n por pesta√±as -->
    <div class="tabs-container">
      <div class="tabs-nav">
        <button
          class="tab-btn"
          [class.active]="activeTab === 'form'"
          (click)="setActiveTab('form')">
          <span class="tab-icon">üìù</span>
          <span class="tab-text">Formulario Manual</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'upload'"
          (click)="setActiveTab('upload')">
          <span class="tab-icon">üìÇ</span>
          <span class="tab-text">Carga Masiva</span>
        </button>
      </div>
    </div>

    <!-- Contenido de pesta√±as -->
    <div class="tab-content">

      <!-- Pesta√±a: Formulario Manual -->
      <div class="tab-panel" [class.active]="activeTab === 'form'">
        <div class="form-container">
          <div class="form-header">
            <h3>Nuevo Registro de Siniestro</h3>
            <p>Complete todos los campos obligatorios para registrar un nuevo siniestro</p>
          </div>

          <form [formGroup]="claimsForm" (ngSubmit)="onSubmitForm()" class="claims-form">

            <!-- Secci√≥n: Informaci√≥n General -->
            <div class="form-section">
              <div class="section-header">
                <h4>Informaci√≥n General del Siniestro</h4>
              </div>

              <div class="form-grid">
                <!-- Obligaci√≥n -->
                <div class="form-group">
                  <label for="obligacion" class="form-label">
                    Obligaci√≥n <span class="required">*</span>
                  </label>
                  <input
                    id="obligacion"
                    type="text"
                    formControlName="obligacion"
                    class="form-control"
                    placeholder="Ej: OBL-2025-0001"
                    [class.error]="getFieldError('obligacion')">
                  <div class="error-message" *ngIf="getFieldError('obligacion')">
                    {{ getFieldError('obligacion') }}
                  </div>
                </div>

                <!-- Fecha Solicitud -->
                <div class="form-group">
                  <label for="fechaSolicitud" class="form-label">
                    Fecha Solicitud <span class="required">*</span>
                  </label>
                  <input
                    id="fechaSolicitud"
                    type="date"
                    formControlName="fechaSolicitud"
                    class="form-control"
                    [class.error]="getFieldError('fechaSolicitud')">
                  <div class="error-message" *ngIf="getFieldError('fechaSolicitud')">
                    {{ getFieldError('fechaSolicitud') }}
                  </div>
                </div>

                <!-- Aval -->
                <div class="form-group">
                  <label for="aval" class="form-label">
                    Aval <span class="required">*</span>
                  </label>
                  <input
                    id="aval"
                    type="text"
                    formControlName="aval"
                    class="form-control"
                    placeholder="Informaci√≥n del aval"
                    [class.error]="getFieldError('aval')">
                  <div class="error-message" *ngIf="getFieldError('aval')">
                    {{ getFieldError('aval') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Informaci√≥n Financiera -->
            <div class="form-section">
              <div class="section-header">
                <h4>Informaci√≥n Financiera</h4>
              </div>

              <div class="form-grid">
                <!-- Valor Capital -->
                <div class="form-group">
                  <label for="valorCapital" class="form-label">
                    Valor Capital <span class="required">*</span>
                  </label>
                  <input
                    id="valorCapital"
                    type="number"
                    formControlName="valorCapital"
                    class="form-control"
                    placeholder="0.00"
                    step="0.01"
                    min="0.01"
                    [class.error]="getFieldError('valorCapital')">
                  <div class="error-message" *ngIf="getFieldError('valorCapital')">
                    {{ getFieldError('valorCapital') }}
                  </div>
                </div>

                <!-- Intereses -->
                <div class="form-group">
                  <label for="intereses" class="form-label">
                    Intereses <span class="required">*</span>
                  </label>
                  <input
                    id="intereses"
                    type="number"
                    formControlName="intereses"
                    class="form-control"
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                    [class.error]="getFieldError('intereses')">
                  <div class="error-message" *ngIf="getFieldError('intereses')">
                    {{ getFieldError('intereses') }}
                  </div>
                </div>

                <!-- Otros Conceptos -->
                <div class="form-group">
                  <label for="otrosConceptos" class="form-label">Otros Conceptos</label>
                  <input
                    id="otrosConceptos"
                    type="number"
                    formControlName="otrosConceptos"
                    class="form-control"
                    placeholder="0.00"
                    step="0.01"
                    min="0">
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Informaci√≥n de Contacto -->
            <div class="form-section">
              <div class="section-header">
                <h4>Informaci√≥n de Contacto</h4>
              </div>

              <div class="form-grid">
                <!-- Direcci√≥n -->
                <div class="form-group full-width">
                  <label for="direccion" class="form-label">
                    Direcci√≥n <span class="required">*</span>
                  </label>
                  <input
                    id="direccion"
                    type="text"
                    formControlName="direccion"
                    class="form-control"
                    placeholder="Direcci√≥n completa"
                    [class.error]="getFieldError('direccion')">
                  <div class="error-message" *ngIf="getFieldError('direccion')">
                    {{ getFieldError('direccion') }}
                  </div>
                </div>

                <!-- C√≥digo Departamento -->
                <div class="form-group">
                  <label for="codigoDepartamento" class="form-label">
                    C√≥digo Departamento <span class="required">*</span>
                  </label>
                  <input
                    id="codigoDepartamento"
                    type="text"
                    formControlName="codigoDepartamento"
                    class="form-control"
                    placeholder="Ej: 11"
                    [class.error]="getFieldError('codigoDepartamento')">
                  <div class="error-message" *ngIf="getFieldError('codigoDepartamento')">
                    {{ getFieldError('codigoDepartamento') }}
                  </div>
                </div>

                <!-- C√≥digo Ciudad -->
                <div class="form-group">
                  <label for="codigoCiudad" class="form-label">
                    C√≥digo Ciudad <span class="required">*</span>
                  </label>
                  <input
                    id="codigoCiudad"
                    type="text"
                    formControlName="codigoCiudad"
                    class="form-control"
                    placeholder="Ej: 11001"
                    [class.error]="getFieldError('codigoCiudad')">
                  <div class="error-message" *ngIf="getFieldError('codigoCiudad')">
                    {{ getFieldError('codigoCiudad') }}
                  </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                  <label for="email" class="form-label">
                    Email <span class="required">*</span>
                  </label>
                  <input
                    id="email"
                    type="email"
                    formControlName="email"
                    class="form-control"
                    placeholder="ejemplo@correo.com"
                    [class.error]="getFieldError('email')">
                  <div class="error-message" *ngIf="getFieldError('email')">
                    {{ getFieldError('email') }}
                  </div>
                </div>

                <!-- Celular -->
                <div class="form-group">
                  <label for="celular" class="form-label">
                    Celular <span class="required">*</span>
                  </label>
                  <input
                    id="celular"
                    type="text"
                    formControlName="celular"
                    class="form-control"
                    placeholder="3001234567"
                    maxlength="10"
                    [class.error]="getFieldError('celular')">
                  <div class="error-message" *ngIf="getFieldError('celular')">
                    {{ getFieldError('celular') }}
                  </div>
                  <small class="form-hint">10 d√≠gitos sin espacios</small>
                </div>
              </div>
            </div>

            <!-- Secci√≥n: Informaci√≥n Empresarial -->
            <div class="form-section">
              <div class="section-header">
                <h4>Cargue Archivos</h4>
              </div>

              <div class="form-grid">
                <!-- Convenio NIT -->
                <div class="form-group">
                  <label for="convenioNit" class="form-label">
                    Convenio NIT <span class="required">*</span>
                  </label>
                  <input
                    id="convenioNit"
                    type="text"
                    formControlName="convenioNit"
                    class="form-control"
                    placeholder="NIT del convenio"
                    [class.error]="getFieldError('convenioNit')">
                  <div class="error-message" *ngIf="getFieldError('convenioNit')">
                    {{ getFieldError('convenioNit') }}
                  </div>
                </div>

                <!-- NIT Empresa -->
                <div class="form-group">
                  <label for="nitEmpresa" class="form-label">
                    NIT Empresa <span class="required">*</span>
                  </label>
                  <input
                    id="nitEmpresa"
                    type="text"
                    formControlName="nitEmpresa"
                    class="form-control"
                    placeholder="NIT de la empresa"
                    [class.error]="getFieldError('nitEmpresa')">
                  <div class="error-message" *ngIf="getFieldError('nitEmpresa')">
                    {{ getFieldError('nitEmpresa') }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                (click)="claimsForm.reset()"
                [disabled]="isLoading">
                Limpiar Formulario
              </button>
              <button
                type="submit"
                class="btn-primary"
                [disabled]="isLoading || claimsForm.invalid">
                <span *ngIf="isLoading" class="loading-spinner"></span>
                {{ isLoading ? 'Guardando...' : 'Guardar Siniestro' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Pesta√±a: Carga Masiva -->
      <div class="tab-panel" [class.active]="activeTab === 'upload'">
        <div class="upload-container">
          <div class="upload-header">
            <h3>Carga Masiva de Siniestros</h3>
            <p>Cargue m√∫ltiples registros de siniestros usando archivos Excel o CSV</p>
          </div>

          <!-- Instrucciones -->
          <div class="upload-instructions">
            <h4>üìã Instrucciones de Carga</h4>
            <ul>
              <li>Descargue la plantilla oficial para evitar errores de formato</li>
              <li>Complete todos los campos obligatorios en el archivo</li>
              <li>Formatos soportados: Excel (.xls, .xlsx) y CSV (.csv)</li>
              <li>Tama√±o m√°ximo del archivo: 10MB</li>
              <li>M√°ximo 5,000 registros por archivo</li>
            </ul>
          </div>

          <!-- Descargar plantilla -->
          <div class="template-section">
            <button
              type="button"
              class="btn-template"
              (click)="downloadTemplate()">
              <span class="btn-icon">üì•</span>
              Descargar Plantilla Excel
            </button>
          </div>

          <!-- √Årea de carga de archivos -->
          <div class="upload-area">
            <div class="file-input-container"
                 (drop)="onFileDrop($event)"
                 (dragover)="onDragOver($event)"
                 (dragleave)="onDragLeave($event)"
                 [class.drag-over]="isDragging">
              <input
                id="fileInput"
                type="file"
                accept=".xls,.xlsx,.csv"
                (change)="onFileSelected($event)"
                class="file-input">
              <label for="fileInput" class="file-input-label">
                <div class="upload-icon">üìÇ</div>
                <div class="upload-text">
                  <span class="primary-text">
                    {{ uploadedFile ? uploadedFile.name : 'Seleccionar archivo' }}
                  </span>
                  <span class="secondary-text">
                    Arrastra un archivo aqu√≠ o haz clic para seleccionar
                  </span>
                </div>
              </label>
            </div>

            <!-- Informaci√≥n del archivo seleccionado -->
            <div class="file-info" *ngIf="uploadedFile">
              <div class="file-details">
                <span class="file-name">{{ uploadedFile.name }}</span>
                <span class="file-size">{{ (uploadedFile.size / 1024 / 1024).toFixed(2) }} MB</span>
              </div>
            </div>

            <!-- Bot√≥n de carga -->
            <div class="upload-actions" *ngIf="uploadedFile">
              <button
                type="button"
                class="btn-primary btn-upload"
                (click)="onUploadFile()"
                [disabled]="isLoading">
                <span *ngIf="isLoading" class="loading-spinner"></span>
                {{ isLoading ? 'Procesando archivo...' : 'Cargar Archivo' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
