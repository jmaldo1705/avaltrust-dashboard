<app-header
  [isSidebarOpen]="isSidebarOpen"
  [isUserMenuOpen]="isUserMenuOpen"
  (toggleSidebar)="toggleSidebar()"
  (toggleUserMenu)="toggleUserMenu()"
  (closeUserMenu)="handleUserMenuClose()"
  (navigate)="onHeaderNavigate($event)"
  (logout)="onLogout()"
></app-header>

<app-sidebar
  [isOpen]="isSidebarOpen"
  (close)="handleSidebarClose()"
  (navigate)="onSidebarNavigate($event)"
></app-sidebar>

<main class="main-content">
  <div *ngIf="loading" class="loading-container">
    <div class="loader"></div>
    <p>Cargando m√≥dulo...</p>
  </div>

  <div *ngIf="error" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>{{ error }}</h2>
    <button class="btn-volver" (click)="volver()">Volver a Escuela Financiera</button>
  </div>

  <div *ngIf="!loading && !error && modulo" class="curso-container">
    <!-- Bot√≥n de volver -->
    <button class="btn-back" (click)="volver()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Volver
    </button>

    <!-- Cabecera del m√≥dulo -->
    <div class="modulo-header">
      <div class="modulo-icon-large">{{ modulo.icono }}</div>
      <h1 class="modulo-titulo">{{ modulo.titulo }}</h1>
      <p class="modulo-descripcion">{{ modulo.descripcion }}</p>
      <div class="modulo-meta">
        <span class="duracion">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          {{ modulo.duracionEstimada }}
        </span>
      </div>
    </div>

    <!-- Introducci√≥n -->
    <section class="seccion introduccion" *ngIf="modulo.introduccion">
      <div class="seccion-icon">üìñ</div>
      <h2 class="seccion-titulo">Introducci√≥n</h2>
      <p class="seccion-texto">{{ modulo.introduccion }}</p>
    </section>

    <!-- Objetivos del m√≥dulo -->
    <section class="seccion objetivos" *ngIf="modulo.objetivos && modulo.objetivos.length > 0">
      <div class="seccion-icon">üéØ</div>
      <h2 class="seccion-titulo">Objetivos del M√≥dulo</h2>
      <ul class="objetivos-lista">
        <li *ngFor="let objetivo of modulo.objetivos" class="objetivo-item">
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          {{ objetivo }}
        </li>
      </ul>
    </section>

    <!-- Contenido del m√≥dulo -->
    <section class="seccion contenido" *ngIf="modulo.secciones && modulo.secciones.length > 0">
      <div class="seccion-icon">üìö</div>
      <h2 class="seccion-titulo">Contenido</h2>
      
      <div *ngFor="let seccion of modulo.secciones" class="seccion-modulo">
        <h3 class="seccion-modulo-titulo">{{ seccion.titulo }}</h3>
        
        <div *ngFor="let punto of seccion.puntos; let i = index" class="punto-contenido">
          <div class="punto-header">
            <span class="punto-numero">{{ i + 1 }}</span>
            <h4 class="punto-titulo">{{ punto.titulo }}</h4>
          </div>
          
          <p class="punto-descripcion" *ngIf="punto.descripcion">{{ punto.descripcion }}</p>

          <!-- Ejemplos pr√°cticos -->
          <div *ngIf="punto.ejemplos && punto.ejemplos.length > 0" class="ejemplos">
            <div *ngFor="let ejemplo of punto.ejemplos" class="ejemplo">
              <div class="ejemplo-content">
                <span class="ejemplo-icon">‚úèÔ∏è</span>
                <p class="ejemplo-texto">{{ ejemplo.texto }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Evaluaci√≥n del curso -->
    <section class="seccion evaluacion">
      <div class="evaluacion-content">
        <div class="evaluacion-icon">{{ modulo.completado ? '‚úÖ' : 'üìù' }}</div>
        <h2 class="evaluacion-titulo">
          {{ modulo.completado ? '¬°Curso Completado!' : 'Evaluaci√≥n del Curso' }}
        </h2>
        <p class="evaluacion-texto" *ngIf="!modulo.completado">
          Pon a prueba tus conocimientos con nuestra evaluaci√≥n. 
          Necesitas obtener al menos 70% para aprobar el curso.
        </p>
        <p class="evaluacion-texto completado" *ngIf="modulo.completado">
          ¬°Felicitaciones! Has completado exitosamente este curso<span *ngIf="modulo.porcentaje"> 
          con una calificaci√≥n de <strong>{{modulo.porcentaje}}%</strong></span><span *ngIf="modulo.puntajeObtenido && modulo.puntajeTotal"> 
          ({{modulo.puntajeObtenido}}/{{modulo.puntajeTotal}} puntos)</span>.
          <br><br>
          Puedes volver a tomar la evaluaci√≥n si deseas mejorar tu puntaje.
        </p>
        <button class="btn-evaluacion" [class.completado]="modulo.completado" (click)="irAEvaluacion()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!modulo.completado">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
          </svg>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="modulo.completado">
            <path d="M9 11l3 3L22 4"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
          {{ modulo.completado ? 'Ver Evaluaci√≥n' : 'Tomar Evaluaci√≥n' }}
        </button>
      </div>
    </section>

    <!-- Cierre inspiracional - Solo si el curso est√° aprobado -->
    <section class="seccion cierre" *ngIf="modulo.completado && modulo.mensajeCierre">
      <div class="cierre-content">
        <div class="cierre-icon">üåü</div>
        <h2 class="cierre-titulo">¬°Felicitaciones!</h2>
        <p class="cierre-texto">{{ modulo.mensajeCierre }}</p>
        <div class="cierre-buttons">
          <button class="btn-certificado" (click)="descargarCertificado()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Descargar Certificado
          </button>
          <button class="btn-continuar" (click)="volver()">
            Continuar Aprendiendo
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </div>
    </section>
  </div>
</main>
