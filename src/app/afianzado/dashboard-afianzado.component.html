<div class="dashboard-layout">
  <!-- Header componente -->
  <app-header
    [isSidebarOpen]="isSidebarOpen"
    [isUserMenuOpen]="isUserMenuOpen"
    (toggleSidebar)="toggleSidebar()"
    (toggleUserMenu)="toggleUserMenu()"
    (closeUserMenu)="closeUserMenu()"
    (navigate)="onHeaderNavigate($event)"
    (logout)="logout()">
  </app-header>

  <!-- Overlay para cerrar men√∫s en m√≥vil -->
  <div
    class="overlay"
    [class.active]="isSidebarOpen || isUserMenuOpen"
    (click)="closeSidebar(); closeUserMenu()">
  </div>

  <!-- Componente Sidebar -->
  <app-sidebar
    [isSidebarOpen]="isSidebarOpen"
    (sidebarClose)="onSidebarClose()"
    (navigate)="onSidebarNavigate($event)">
  </app-sidebar>

  <!-- Contenido principal -->
  <main class="main-content">
    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando informaci√≥n...</p>
    </div>

    <div class="error" *ngIf="error && !loading">
      <p>{{ error }}</p>
      <button (click)="loadDashboard()">Reintentar</button>
    </div>

    <div class="dashboard-content" *ngIf="dashboard && !loading">
      <!-- Header con informaci√≥n del afianzado -->
      <div class="content-header">
        <h2>Mi Dashboard</h2>
        <p class="welcome-message">
          Bienvenido, <strong>{{ dashboard.nombreAfianzado }}</strong> - Documento: {{ dashboard.documentoIdentidad }}
        </p>
      </div>

    <!-- Tarjetas de resumen -->
    <div class="summary-cards">
      <div class="card total-deuda">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <h3>Deuda Total</h3>
          <p class="amount">{{ formatCurrency(dashboard.deudaTotal) }}</p>
        </div>
      </div>

      <div class="card total-mora">
        <div class="card-icon">‚ö†Ô∏è</div>
        <div class="card-content">
          <h3>Mora Total</h3>
          <p class="amount">{{ formatCurrency(dashboard.moraTotal) }}</p>
        </div>
      </div>

      <div class="card total-obligaciones">
        <div class="card-icon">üìã</div>
        <div class="card-content">
          <h3>Total Obligaciones</h3>
          <p class="amount">{{ dashboard.totalObligaciones }}</p>
        </div>
      </div>

      <div class="card obligaciones-al-dia">
        <div class="card-icon">‚úÖ</div>
        <div class="card-content">
          <h3>Al D√≠a</h3>
          <p class="amount">{{ dashboard.obligacionesAlDia }}</p>
        </div>
      </div>

      <div class="card obligaciones-mora">
        <div class="card-icon">‚ùå</div>
        <div class="card-content">
          <h3>En Mora</h3>
          <p class="amount">{{ dashboard.obligacionesEnMora }}</p>
        </div>
      </div>
    </div>

    <!-- Tabla de obligaciones -->
    <div class="obligaciones-section">
      <h2>Detalle de Obligaciones</h2>
      <div class="table-responsive">
        <table class="obligaciones-table">
          <thead>
            <tr>
              <th>Obligaci√≥n</th>
              <th>Empresa</th>
              <th>Valor Total</th>
              <th>Saldo Actual</th>
              <th>Cuota Mensual</th>
              <th>Fecha Vencimiento</th>
              <th>Estado</th>
              <th>D√≠as Mora</th>
              <th>Valor Mora</th>
              <th>Certificado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let obligacion of dashboard.obligaciones">
              <td>{{ obligacion.numeroObligacion }}</td>
              <td>{{ obligacion.nombreEmpresa }}</td>
              <td>{{ formatCurrency(obligacion.valorTotal) }}</td>
              <td>{{ formatCurrency(obligacion.saldoActual) }}</td>
              <td>{{ formatCurrency(obligacion.cuotaMensual) }}</td>
              <td>{{ formatDate(obligacion.fechaVencimiento) }}</td>
              <td>
                <span [class]="'estado-badge ' + getEstadoClass(obligacion.estado)">
                  {{ obligacion.estado }}
                </span>
              </td>
              <td>
                <span [class]="obligacion.diasMora > 0 ? 'dias-mora-alert' : ''">
                  {{ obligacion.diasMora }}
                </span>
              </td>
              <td>{{ formatCurrency(obligacion.valorMora) }}</td>
              <td>
                <button 
                  class="btn-download" 
                  (click)="descargarCertificado(obligacion.numeroObligacion)" 
                  title="Descargar Certificado de Fianza">
                  <svg class="pdf-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M10.1,11.4C10.08,11.44 9.81,13.16 8,16.09C8,16.09 4.5,17.91 5.33,19.27C6,20.35 7.65,19.23 9.07,16.59C9.07,16.59 10.89,15.95 13.31,15.77C13.31,15.77 17.17,17.5 17.7,15.66C18.22,13.8 14.64,14.22 14,14.41C14,14.41 12,13.06 11.5,11.2C11.5,11.2 12.64,7.25 10.89,7.3C9.14,7.35 9.8,10.43 10.1,11.4M10.91,12.44C10.94,12.45 11.38,13.65 12.8,14.9C12.8,14.9 10.47,15.36 9.41,15.8C9.41,15.8 10.41,14.07 10.91,12.44M14.84,15.16C15.42,15 17.17,15.31 17.1,15.64C17.04,15.97 14.84,15.16 14.84,15.16M7.77,17C7.24,18.24 6.33,19 6.1,19C5.87,19 6.8,17.4 7.77,17M10.91,10.07C10.91,10 10.55,7.87 10.91,7.92C11.45,8 10.91,10 10.91,10.07Z"/>
                  </svg>
                  <span>Descargar PDF</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="no-data" *ngIf="dashboard.obligaciones.length === 0">
        <p>No tienes obligaciones registradas en este momento.</p>
      </div>
    </div>
    </div>
  </main>
</div>
